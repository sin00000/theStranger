<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Korean Jamo Decomposition System</title>
    <script src="https://cdn.jsdelivr.net/npm/hangul-js"></script>
    <style>
        body {
            font-family: 'Malgun Gothic', '맑은 고딕', Arial, sans-serif;
            max-width: 1200px;
            margin: 40px auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            border-bottom: 2px solid #4CAF50;
            padding-bottom: 10px;
        }
        .sentence {
            font-size: 24px;
            margin: 20px 0;
            padding: 15px;
            background: #e8f5e9;
            border-radius: 4px;
        }
        pre {
            background: #263238;
            color: #aed581;
            padding: 20px;
            border-radius: 4px;
            overflow-x: auto;
            font-size: 14px;
            line-height: 1.5;
        }
        .section {
            margin: 30px 0;
        }
        h2 {
            color: #4CAF50;
            margin-top: 30px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Korean Jamo Decomposition & Mapping System</h1>

        <div class="section">
            <h2>Original Sentence:</h2>
            <div class="sentence" id="original-sentence"></div>
        </div>

        <div class="section">
            <h2>Jamo Mapping (Each jamo → All target positions):</h2>
            <pre id="jamo-mapping"></pre>
        </div>

        <div class="section">
            <h2>Syllable States:</h2>
            <pre id="syllable-states"></pre>
        </div>
    </div>

    <script>
        const sentence = "오늘 엄마가 죽었다. 어쩌면 어제.";

        // Display original sentence
        document.getElementById('original-sentence').textContent = sentence;

        // Initialize data structures
        const jamoMapping = {}; // jamo → array of target positions
        const syllableStates = []; // array of syllable objects with state

        // Process each character in the sentence
        let syllableIndex = 0;

        for (let i = 0; i < sentence.length; i++) {
            const char = sentence[i];

            // Skip spaces and punctuation
            if (!/[가-힣]/.test(char)) {
                continue;
            }

            // Decompose the character into jamo
            const disassembled = Hangul.disassemble(char);

            // Create syllable state object
            const syllableState = {
                text: char,
                initial: null,
                medial: null,
                final: null
            };

            // Process initial consonant (초성)
            if (disassembled.length >= 1) {
                const initialJamo = disassembled[0];
                syllableState.initial = {
                    jamo: initialJamo,
                    filled: false
                };

                // Add to jamo mapping
                if (!jamoMapping[initialJamo]) {
                    jamoMapping[initialJamo] = [];
                }
                jamoMapping[initialJamo].push({
                    syllableIndex: syllableIndex,
                    syllable: char,
                    position: "initial",
                    filled: false
                });
            }

            // Process medial vowel (중성)
            if (disassembled.length >= 2) {
                const medialJamo = disassembled[1];
                syllableState.medial = {
                    jamo: medialJamo,
                    filled: false
                };

                // Add to jamo mapping
                if (!jamoMapping[medialJamo]) {
                    jamoMapping[medialJamo] = [];
                }
                jamoMapping[medialJamo].push({
                    syllableIndex: syllableIndex,
                    syllable: char,
                    position: "medial",
                    filled: false
                });
            }

            // Process final consonant (종성) if exists
            if (disassembled.length >= 3) {
                const finalJamo = disassembled[2];
                syllableState.final = {
                    jamo: finalJamo,
                    filled: false
                };

                // Add to jamo mapping
                if (!jamoMapping[finalJamo]) {
                    jamoMapping[finalJamo] = [];
                }
                jamoMapping[finalJamo].push({
                    syllableIndex: syllableIndex,
                    syllable: char,
                    position: "final",
                    filled: false
                });
            }

            syllableStates.push(syllableState);
            syllableIndex++;
        }

        // Display the mappings
        console.log("=== JAMO MAPPING ===");
        console.log(JSON.stringify(jamoMapping, null, 2));

        console.log("\n=== SYLLABLE STATES ===");
        console.log(JSON.stringify(syllableStates, null, 2));

        // Verify "ㅁ" appears 3 times as per requirement
        console.log("\n=== VERIFICATION: ㅁ positions ===");
        if (jamoMapping["ㅁ"]) {
            console.log(`"ㅁ" appears ${jamoMapping["ㅁ"].length} times:`);
            jamoMapping["ㅁ"].forEach((pos, idx) => {
                console.log(`  ${idx + 1}. Syllable "${pos.syllable}" at index ${pos.syllableIndex}, position: ${pos.position}`);
            });
        }

        // Display in HTML
        document.getElementById('jamo-mapping').textContent = JSON.stringify(jamoMapping, null, 2);
        document.getElementById('syllable-states').textContent = JSON.stringify(syllableStates, null, 2);

        // Additional statistics
        console.log("\n=== STATISTICS ===");
        console.log(`Total unique jamo: ${Object.keys(jamoMapping).length}`);
        console.log(`Total syllables: ${syllableStates.length}`);

        // Show which jamo appear multiple times
        console.log("\n=== DUPLICATE JAMO (appearing more than once) ===");
        Object.entries(jamoMapping).forEach(([jamo, positions]) => {
            if (positions.length > 1) {
                console.log(`"${jamo}": ${positions.length} occurrences`);
            }
        });
    </script>
</body>
</html>
